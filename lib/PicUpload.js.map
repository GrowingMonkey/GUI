{"version":3,"sources":["../src/PicUpload.jsx"],"names":["UploadButton","beforeUpload","file","isJPG","type","indexOf","error","isLt2M","size","props","word","PicUpload","fileList","value","map","item","uid","id","url","state","previewVisible","nextProps","setState","num","slice","showPreviewIcon","showRemoveIcon","disabled","accept","multiple","handlePreview","handleChange","handleRemoveImg","data","length","handleCancel","width","previewImage","Component","status","filter","list","forEach","response","push","name","every","triggerChange","onChange","obj","thumbUrl","resolve","reject","post","res","msg","catch"],"mappings":"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","file":"PicUpload.js","sourcesContent":["import React from 'react';\r\nimport {Icon,Upload,message,Modal} from 'antd';\r\nimport NetUitl from './NetUitl';\r\nfunction beforeUpload(file) {\r\n  const isJPG = file.type.indexOf('image')>-1;\r\n  if (!isJPG) {\r\n    message.error('只能上传图片!');\r\n  }\r\n  const isLt2M = file.size / 1024 / 1024 < 3;\r\n  if (!isLt2M) {\r\n    message.error('只能上传小于3M的图片!');\r\n  }\r\n  return isJPG && isLt2M;\r\n}\r\nexport function UploadButton(props){\r\n  return (\r\n    <div>\r\n        <Icon type=\"plus\" />\r\n        <div className=\"ant-upload-text\">{props.word?props.word:\"Upload\"}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nclass PicUpload extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const fileList=this.props.value?this.props.value.map(item=>Object.assign(item,{uid:item.id?item.id:item.url})):[];\r\n    this.state = {\r\n        fileList,\r\n        previewVisible:false,\r\n    };\r\n  }\r\n  componentWillReceiveProps(nextProps) {\r\n    this.setState({\r\n        fileList:nextProps.value?nextProps.value.map(item=>Object.assign(item,{uid:item.id?item.id:item.url})):[]\r\n    });\r\n  }\r\n  handleChange = ({ file,fileList }) => {\r\n    if(!file.status){//beforeUpload返回false时也会触发handleChange\r\n      fileList=this.state.fileList\r\n    }\r\n    if(file.status=='error'){\r\n      message.error(\"上传失败，请重试\");\r\n      fileList=fileList.filter(item=>item.status!=\"error\");\r\n    }\r\n    const list=[];\r\n    fileList.forEach(item=>{\r\n        if(item.response){\r\n            if(item.response.status==10200){\r\n                list.push(Object.assign(file.response.data,{uid:file.response.data.id?file.response.data.id:file.response.data.url}));\r\n            }else{\r\n                message.error(\"文件：\"+item.name+\"上传失败，请重试\")\r\n            }\r\n        }else{\r\n            list.push(item)\r\n        }\r\n    })\r\n    this.setState({fileList:list});\r\n    if(list.every(item=>!item.status)){\r\n        this.triggerChange(list);\r\n    }\r\n    \r\n  }\r\n  triggerChange = (fileList) => {\r\n    const onChange = this.props.onChange;\r\n    const list=fileList.map(item=>{\r\n            let obj=item.response?item.response.data:item;\r\n            return obj;\r\n        });\r\n    if (onChange) {\r\n      onChange(list);\r\n    }\r\n  }\r\n  handlePreview = (file) => {\r\n    this.setState({\r\n      previewImage: file.url || file.thumbUrl,\r\n      previewVisible: true,\r\n    });\r\n  }\r\n  handleCancel=()=>{\r\n    this.setState({\r\n      previewVisible:false\r\n    })\r\n  }\r\n    handleRemoveImg=(file)=>{\r\n        const type=this.props.type?this.props.type:\"commodities\";\r\n        return new Promise(function(resolve,reject){\r\n        NetUitl.post('/api/v1/pictures/'+type+'/discard',file,(res)=>{\r\n            if(res.status==10200){\r\n            resolve(true)\r\n            }else{\r\n            message.error(res.msg);\r\n            reject('error')\r\n            }\r\n        })\r\n        }).catch(function(error){\r\n            return false;\r\n        });\r\n    }\r\n  render() {\r\n    const {word,num}=this.props;\r\n    let fileList=this.state.fileList;\r\n    if(num) fileList=fileList.slice(0,num);\r\n    return (<span>\r\n        <Upload\r\n          action=\"/api/v1/pictures\"\r\n          listType=\"picture-card\"\r\n          name=\"imgFile\"\r\n          fileList={fileList}\r\n          showUploadList={{showPreviewIcon:true, showRemoveIcon:this.props.disabled?false:true}}\r\n          beforeUpload={beforeUpload}\r\n          accept={this.props.accept?this.props.accept:\"image/jpg,image/jpeg,image/png,image/gif\"}\r\n          multiple={!!this.props.multiple}\r\n          onPreview={this.handlePreview}\r\n          onChange={this.handleChange}\r\n          onRemove={this.handleRemoveImg}\r\n          data={this.props.data}\r\n        >\r\n            {this.state.fileList.length<num && !this.props.disabled?<UploadButton word={word?word:\"Upload\"}/>:null}\r\n        </Upload>\r\n        <Modal visible={this.state.previewVisible} footer={null} onCancel={this.handleCancel}>\r\n            <img alt=\"example\" style={{ width: '100%' }} src={this.state.previewImage} />\r\n        </Modal>\r\n        </span>\r\n    );\r\n  }\r\n}\r\nexport default PicUpload;"]}